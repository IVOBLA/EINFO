@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===========================================================
   MODERN DASHBOARD THEME – Feuerwehr Einsatzstellen-Übersicht
   Stand: 2025-10-08
   =========================================================== */

/* === GLOBAL === */
:root { --row-gap: .5rem; --card-pad: .6rem; }         /* (5) Dichte-Schalter Basis */
.ui-dense { --row-gap: .35rem; --card-pad: .45rem; }   /* (5) kompakter Modus */

html, body {
  @apply bg-gradient-to-br from-slate-50 via-slate-100 to-slate-200 text-slate-800 antialiased;
}

/* === GLOBAL DENSITY VARIABLES === */
html {
  --row-gap: .6rem;           /* Karten-Abstand */
  --card-pad: .75rem;         /* Karten-Innenabstand */
  --chip-pad-y: .28rem;       /* KPI-Badges */
  --chip-pad-x: .55rem;

  --ctl-h: 36px;              /* EINHEITLICHE HÖHE Header-Controls */
  --ctl-pad-x: 12px;
  --ctl-minw: 72px;           /* einheitliche Mindestbreite für Hauptbuttons */
  --veh-pad-y: .30rem;        /* Fahrzeugchips */
  --veh-pad-x: .45rem;
}

html.ui-dense {
  --row-gap: .35rem;
  --card-pad: .45rem;
  --chip-pad-y: .18rem;
  --chip-pad-x: .40rem;

  --ctl-h: 30px;
  --ctl-pad-x: 10px;
  --ctl-minw: 64px;
  --veh-pad-y: .22rem;
  --veh-pad-x: .35rem;
}

* { scrollbar-width: thin; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.25); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.4); }

/* Tastatur-Fokus (8) */
:focus-visible { outline: 3px solid #93c5fd; outline-offset: 2px; border-radius: .5rem; }

/* === HEADER === */
header {
  @apply bg-white/80 backdrop-blur-md shadow-md rounded-xl px-4 py-3 mb-4 border border-slate-200 flex flex-wrap items-center justify-between gap-2;
}
header h1 { @apply text-2xl md:text-3xl font-bold tracking-tight text-slate-800 drop-shadow-sm; }

/* Sync/Countdown-Chip (6) */
.sync-chip{
  display:inline-flex; align-items:center; gap:.4rem;
  font-size:.75rem; padding:.25rem .55rem; border-radius:999px;
  background:#f1f5f9; border:1px solid rgba(15,23,42,.08);
}
.sync-chip[data-state="warn"]{ background:#fff7ed; color:#9a3412; }

/* === BUTTONS === */
button { @apply transition-all duration-200 ease-out select-none; }
button:hover:not(:disabled) { @apply scale-[1.02]; }
button:disabled { @apply opacity-60 cursor-not-allowed; }
button.bg-blue-600, button.bg-purple-600, button.bg-emerald-600 { @apply shadow-md text-white; }
button.bg-blue-600:hover { @apply shadow-lg bg-blue-700; }
button.bg-purple-600:hover { @apply shadow-lg bg-purple-700; }
button.bg-emerald-600:hover { @apply shadow-lg bg-emerald-700; }
button.bg-gray-700:hover { @apply bg-gray-800; }

/* === FORM ELEMENTE === */
input[type="text"], input[type="number"], select{
  @apply border border-slate-300 rounded-md px-2 py-1 text-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all duration-150 bg-white/90;
}

/* === QUICK ADD SECTION === */
section.mb-2 { @apply bg-white/70 backdrop-blur-md border border-slate-200 shadow-sm rounded-xl px-3 py-3; }

/* === SIDEBAR (Einheiten frei) === */
section.bg-white.rounded-xl { @apply shadow-md hover:shadow-lg transition-shadow duration-200; }
section.bg-white.rounded-xl > div:first-child {
  margin-bottom: 0.5rem; /* entspricht mb-2 (Fix für Tailwind @apply-Zyklus) */
  @apply border-b border-slate-200 pb-1;
}

/* Gruppen-Header + Count (4) */
button[title="aufklappen"], button[title="zuklappen"]{
  @apply bg-gradient-to-r from-slate-100 to-slate-50 hover:from-slate-200 hover:to-slate-100 border-b border-slate-200;
}
button[title="aufklappen"] span:first-child,
button[title="zuklappen"] span:first-child{ @apply font-semibold text-slate-700; }
.group-chip{
  font-size:.70rem; padding:.05rem .4rem; border-radius:999px;
  background:#eef2ff; color:#3730a3; font-weight:700;
  border:1px solid rgba(55,48,163,.15);
}
/* Abstand Header → Liste (4) */
button[title="aufklappen"] + div, button[title="zuklappen"] + div { margin-top:.5rem; }

/* Fahrzeuge (Draggable) */
.draggable-vehicle{
  @apply rounded-2xl bg-slate-50 border border-slate-200 shadow-sm hover:bg-slate-100 transition-all duration-150 cursor-grab active:cursor-grabbing;
}

/* === SPALTEN (NEU, IN BEARBEITUNG, ERLEDIGT) === */
.droppable-column{ @apply rounded-xl shadow-md border border-slate-200 bg-white/80 backdrop-blur-sm transition-all duration-200; }
.droppable-column:hover{ @apply shadow-lg; }
/* Sticky Spaltenkopf (1) */
.column-header{
  position:sticky; top:0; z-index:5;
  background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
  backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(15, 23, 42, .08);
  padding:.5rem .5rem .4rem .75rem;
}
/* KPI Badges (1) */
.kpi-badge{
  display:inline-flex; align-items:center; gap:.35rem;
  font-size:.72rem; font-weight:600;
  padding:.2rem .45rem; border-radius:999px;
  background:#f1f5f9; color:#0f172a;
}
.kpi-badge[data-variant="units"]{ background:#e0f2fe; }
.kpi-badge[data-variant="persons"]{ background:#e2e8f0; }
.kpi-badge[data-variant="cards"]{ background:#dcfce7; }
/* Drop-Over Feedback (7) – Wrapper .drag-over rund um DroppableColumn */
.drag-over .droppable-column{
  outline: 2px dashed #60a5fa; outline-offset: 2px;
  background: linear-gradient(180deg, rgba(224,242,254,.35), transparent);
}

/* Spalten-Farbhintergründe (dezenter) */
.bg-red-100  { @apply bg-rose-100/70; }
.bg-yellow-100{ @apply bg-amber-100/70; }
.bg-green-100 { @apply bg-emerald-100/70; }

/* === KARTEN (EINSÄTZE) === */
.card, ul.space-y-2 > li { @apply bg-white/90 backdrop-blur-sm border border-slate-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200; }
.card:hover{ @apply -translate-y-[1px]; }
/* Dichte-Effekt anwenden (5) */
ul.space-y-2 > li{ margin-top: var(--row-gap) !important; }
.card{ padding: var(--card-pad) !important; }
/* Titel/Adresse: kompakt & clamp (10 / 2) */
.card .card-title{
  font-weight:700; letter-spacing:.1px;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
}
.card .card-sub{ font-size:.78rem; color:#475569; }

/* „Karte“-Link als Icon-Style (3 – generisch, ohne Codeänderung) */
a[href*="karte"], button[title*="Karte"]{
  display:inline-flex; align-items:center; gap:.35rem; font-size:.78rem; color:#2563eb;
}
a[href*="karte"]:hover, button[title*="Karte"]:hover{ text-decoration: underline; }

/* === DRAG OVERLAY === */
.drag-overlay{ @apply border-2 border-blue-300 bg-white rounded-xl shadow-xl; }

/* === FLOATING HILFE-BUTTON === */
a[href$="Hilfe.pdf"]{
  @apply bg-blue-600 text-white shadow-lg hover:bg-blue-700 hover:shadow-xl fixed bottom-4 right-4 rounded-full px-5 py-2 font-semibold transition-all duration-200;
}

/* === NEAR PULSE (Hervorgehobene Fahrzeuge) === */
.near-pulse{ animation: pulseGlow 1.5s infinite ease-in-out; }
@keyframes pulseGlow{
  0%,100%{ box-shadow: 0 0 0 0 rgba(59,130,246,0.4); }
  50%{ box-shadow: 0 0 10px 6px rgba(59,130,246,0.6); }
}

/* FAB „Einsatz anlegen“ (9) */
.fab{
  position: fixed; right: 1.25rem; bottom: 4.25rem; z-index: 40;
  width: 56px; height: 56px; border-radius: 999px;
  background:#22c55e; color:#fff; box-shadow:0 8px 24px rgba(16,185,129,.35);
  display:flex; align-items:center; justify-content:center; font-size:24px; line-height:1;
}
.fab:hover{ filter: brightness(.95); }

/* Einheitliche Maße in der Kopfzeile */
header .toolbar > * {
  height: var(--ctl-h);
}
header .toolbar button,
header .toolbar a,
header .toolbar .sync-chip,
header .toolbar label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: var(--ctl-minw);
  padding: 0 var(--ctl-pad-x);
  border-radius: 10px;
}

/* PDF/Import als Primärbuttons dürfen gleich breit wirken */
header .toolbar button.bg-purple-600,
header .toolbar button.bg-blue-600 {
  font-weight: 600;
}

/* Checkbox-Label kompakt ausrichten */
header .toolbar label {
  gap: .5rem;
  background: #fff;
  border: 1px solid rgba(15,23,42,.1);
}

/* Inputs an Höhe angleichen */
header .toolbar input[type="number"],
header .toolbar input[type="text"],
header .toolbar select {
  height: var(--ctl-h);
  padding: 0 var(--ctl-pad-x);
  min-width: 64px;
  border-radius: 10px;
}

/* Countdown-/Status-Chip angleichen */
.sync-chip {
  height: var(--ctl-h);
  min-width: var(--ctl-minw);
  padding: 0 var(--ctl-pad-x);
}

/* Kleiner grüner Dot nur wenn Auto-Import aktiv (Klasse 'active' im JSX setzen, optional) */
.sync-chip.active::before {
  content: "";
  width: .5em; height: .5em; border-radius: 999px;
  background:#22c55e; display:inline-block; margin-right:.35rem;
  animation: pulseDot 1.8s infinite;
}
@keyframes pulseDot { 0%,100%{opacity:.35} 50%{opacity:1} }

/* Intervall-Kapsel: Input darf keinen eigenen Radius/Ring haben */
header .toolbar .interval-capsule input {
  border-radius: 0 !important;
  outline: none !important;
  box-shadow: none !important;
}
header .toolbar .interval-capsule input:focus {
  border: 0 !important;
  box-shadow: none !important; /* killt focus:ring */
}
/* ---------- Viewport-basierte Skalierung ---------- */
:root {
  --ui-scale: 0.92;          /* Standard-Grundgröße */
}
.ui-dense {
  --ui-scale: 0.70;          /* deutlich kompakter bei vielen Karten */
}

/* ---------- Karten & Spalten in dichter Ansicht ---------- */
.ui-dense .column-header { font-size: 0.95em; }
.ui-dense .kpi-badge { transform: scale(0.92); }

.ui-dense .sortable-card {
  padding: 0.5rem 0.6rem !important;
  border-radius: 0.5rem !important;
}
.ui-dense .sortable-card .card-title { font-size: 0.95em; }
.ui-dense .sortable-card .meta-line { font-size: 0.86em; }

.ui-dense .chip,
.ui-dense .group-chip {
  transform: scale(0.9);
}

.ui-dense .space-y-2 > :where(* + *) { margin-top: 0.35rem; } /* weniger vertikaler Abstand */

@keyframes glowPulseRedFull {
  0%   { box-shadow: 0 0 0 rgba(239,68,68,0.0); transform: scale(1.00); opacity: 1; }
  30%  { box-shadow: 0 0 25px rgba(239,68,68,0.6); transform: scale(1.015); opacity: 0.9; }
  50%  { box-shadow: 0 0 32px rgba(239,68,68,0.75); transform: scale(1.025); opacity: 1; }
  70%  { box-shadow: 0 0 25px rgba(239,68,68,0.6); transform: scale(1.015); opacity: 0.9; }
  100% { box-shadow: 0 0 0 rgba(239,68,68,0.0); transform: scale(1.00); opacity: 1; }
}

.pulse-card-red {
  animation: glowPulseRedFull 1.6s ease-in-out infinite;
  border-radius: 12px;
  will-change: transform, box-shadow, opacity;
}

/* Innerer, sanfter Licht-Impuls (atmet nach innen) */
@keyframes pulseInnerRed {
  0%   { background-color: rgba(239,68,68,0.10); transform: scale(1.00); }
  50%  { background-color: rgba(239,68,68,0.25); transform: scale(0.98); }
  100% { background-color: rgba(239,68,68,0.10); transform: scale(1.00); }
}
.animate-pulse-inner {
  animation: pulseInnerRed 1.4s ease-in-out infinite;
  border-radius: 12px;
  will-change: transform, background-color;
  z-index: 0;
}

/* Äußerer Ping-Ring (langsamer als Tailwind-Standard) */
@keyframes pingSlow {
  0%   { transform: scale(1.00); opacity: 0.8; }
  70%  { transform: scale(1.20); opacity: 0.15; }
  100% { transform: scale(1.28); opacity: 0.00; }
}
.animate-ping-slow {
  animation: pingSlow 1.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  will-change: transform, opacity;
  z-index: 1;
}
/* Äußerer Ping als Shadow-Welle: keine Layout-Änderung, kein scale -> kein X-Scroll */
@keyframes pingSafe {
  0%   { box-shadow: 0 0 0 0 rgba(239,68,68,0.55); }
  60%  { box-shadow: 0 0 0 14px rgba(239,68,68,0.15); }
  100% { box-shadow: 0 0 0 18px rgba(239,68,68,0.00); }
}
.animate-ping-safe {
  animation: pingSafe 1.8s cubic-bezier(0.4,0,0.2,1) infinite;
  will-change: box-shadow;
}
 /* --- Puls-Effekt für neu eingetroffene Aufgaben (nicht von mir erstellt) --- */
 @keyframes pulseIncoming {
   0%   { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.55);   transform: translateZ(0); }
   60%  { box-shadow: 0 0 0 14px rgba(239, 68, 68, 0.00); }
   100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.00); }
 }
 .pulse-incoming {
   animation: pulseIncoming 1.6s ease-out 0s 5;
   border-color: rgba(239, 68, 68, 0.55) !important; /* leicht rot betonen */
 }
  /* Externe Aufgaben (aus Protokoll) – grüner Rand */
 .ext-external {
  border-color: #22c55e !important;
   box-shadow: 0 0 0 1px rgba(34,197,94,.35) inset;
}