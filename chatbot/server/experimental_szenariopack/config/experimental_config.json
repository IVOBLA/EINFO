{
  "nlu": {
    "llm": {
      "system_prompt": "Du bist ein NLU-Parser. Antworte NUR mit einem JSON-Objekt.\nFormat:\n{\n  \"absicht\": \"WETTER_ABFRAGE|RESSOURCE_ABFRAGE|LOGISTIK_ANFRAGE|BEFEHL|PLAN_ZEIT|PLAN_WENN_DANN|ANTWORT|UNKLAR\",\n  \"vertrauen\": 0.0,\n  \"felder\": { \"pegel\": 0, \"minuten\": 0, \"aktion\": \"\", \"ressource\": \"\", \"antwort\": \"\" },\n  \"rueckfrage\": null\n}\nKeine zusätzlichen Felder, kein Text außerhalb des JSON.",
      "options": {
        "taskType": "analysis",
        "stream": false,
        "requireJson": true,
        "maxTokens": 256,
        "temperature": 0
      }
    },
    "heuristic": {
      "yes_words": ["ja", "jawohl", "yes", "ok"],
      "no_words": ["nein", "no", "negativ"],
      "keywords": {
        "weather": ["wetter", "regen", "vorhersage"],
        "logistics": ["verpflegung", "verpflegen", "essen", "trinken", "logistik"],
        "command": ["befehl", "anweisen", "beauftragen", "ordne", "ordnung"]
      },
      "resource": {
        "regex": { "pattern": "(bagger|pumpe|pumpen|aggregat|sandsack)", "flags": "i" },
        "default_label": "Ressourcen"
      },
      "regex": {
        "number": { "pattern": "(\\d+[\\.,]?\\d*)", "flags": "" },
        "minutes": { "pattern": "(\\d+)\\s*(minuten|min|m)", "flags": "i" },
        "pegel_condition": { "pattern": "wenn\\s+pegel\\s*>=?\\s*\\d+", "flags": "i" },
        "pegel_extract": { "pattern": "pegel\\s*>=?\\s*(\\d+)", "flags": "i" },
        "action_after_then": { "pattern": "dann\\s+(.+)", "flags": "i" },
        "action_after_minutes": { "pattern": "(?:in\\s+\\d+\\s*min(?:uten)?\\s+)(.+)", "flags": "i" }
      }
    }
  },
  "npc_triggers": {
    "parsers": [
      {
        "id": "pegel_gte",
        "regex": { "pattern": "pegel\\s*>=\\s*(\\d+)", "flags": "i" },
        "operator": "gte",
        "field": "pegel"
      }
    ]
  },
  "ops": {
    "budgets": {
      "protokollCreateMax": 3,
      "tasksCreateMax": 2,
      "incidentsCreateMax": 1,
      "updatesMax": 2
    },
    "dedupeWindow": 20,
    "fallbackCooldownTicks": 3,
    "fallbackTaskCooldownTicks": 10
  },
  "parameter_beschreibung": {
    "nlu": {
      "llm": {
        "system_prompt": "System-Prompt für den LLM-basierten NLU-Parser. Muss ein JSON-Objekt ohne Zusatztext erzwingen.",
        "options": {
          "taskType": "Verarbeitungsmodus für das LLM (z.B. analysis).",
          "stream": "Ob das LLM gestreamt antwortet (false empfohlen für JSON-Parsing).",
          "requireJson": "Erzwingt JSON-Antworten vom LLM.",
          "maxTokens": "Maximale Anzahl Tokens in der LLM-Antwort.",
          "temperature": "Zufall/Varianz der LLM-Antwort (0 = deterministisch)."
        }
      },
      "heuristic": {
        "yes_words": "Liste von Bestätigungswörtern für die Heuristik.",
        "no_words": "Liste von Verneinungswörtern für die Heuristik.",
        "keywords": {
          "weather": "Schlüsselwörter zur Erkennung von Wetterabfragen.",
          "logistics": "Schlüsselwörter zur Erkennung von Logistik-Anfragen.",
          "command": "Schlüsselwörter zur Erkennung von Befehlen."
        },
        "resource": {
          "regex": {
            "pattern": "Regex zur Erkennung von Ressourcen-Nennungen.",
            "flags": "Regex-Flags (z.B. i für case-insensitive)."
          },
          "default_label": "Fallback-Bezeichnung für gefundene Ressourcen."
        },
        "regex": {
          "number": {
            "pattern": "Regex zur Extraktion beliebiger Zahlen.",
            "flags": "Regex-Flags."
          },
          "minutes": {
            "pattern": "Regex zur Extraktion von Minutenangaben.",
            "flags": "Regex-Flags."
          },
          "pegel_condition": {
            "pattern": "Regex zur Erkennung einer Pegel-Bedingung (z.B. wenn pegel >= 420).",
            "flags": "Regex-Flags."
          },
          "pegel_extract": {
            "pattern": "Regex zur Extraktion des Pegelwerts.",
            "flags": "Regex-Flags."
          },
          "action_after_then": {
            "pattern": "Regex zur Extraktion der Aktion nach 'dann'.",
            "flags": "Regex-Flags."
          },
          "action_after_minutes": {
            "pattern": "Regex zur Extraktion einer Aktion nach Zeitangabe.",
            "flags": "Regex-Flags."
          }
        }
      }
    },
    "npc_triggers": {
      "parsers": [
        {
          "id": "Eindeutiger Parser-Identifier.",
          "regex": {
            "pattern": "Regex zur Extraktion von Trigger-Werten.",
            "flags": "Regex-Flags."
          },
          "operator": "Vergleichsoperator für die Auswertung (z.B. gte).",
          "field": "Ziel-Feld im Szenariozustand (z.B. pegel)."
        }
      ]
    },
    "ops": {
      "budgets": {
        "protokollCreateMax": "Maximale Anzahl neuer Protokolleinträge pro Tick.",
        "tasksCreateMax": "Maximale Anzahl neuer Aufgaben pro Tick.",
        "incidentsCreateMax": "Maximale Anzahl neuer Einsätze pro Tick.",
        "updatesMax": "Maximale Anzahl Update-Operationen pro Tick."
      },
      "dedupeWindow": "Sliding-Window-Größe für Protokoll-Dedupe.",
      "fallbackCooldownTicks": "Cooldown in Ticks für Fallback-Protokoll.",
      "fallbackTaskCooldownTicks": "Cooldown in Ticks für Fallback-Aufgaben."
    }
  }
}
